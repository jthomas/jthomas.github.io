
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Capturing Runtime Metrics For OpenWhisk Applications - James Thomas</title>
  <meta name="author" content="James Thomas">

  
  <meta name="description" content="Capturing runtime metrics for serverless applications with IBM Cloud Functions (OpenWhisk) using IBM Cloud Monitoring service.">
  <meta name="keywords" content="openwhisk monitoring metrics serverless ibm cloud">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jthomas.github.com/jthomas/blog/2017/12/18/capturing-runtime-metrics-for-openwhisk-applications/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/JamesThomas" rel="alternate" title="James Thomas" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26491341-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">James Thomas</a></h1>
  
    <h2>Notes on software.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/JamesThomas" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jthomas.github.com/jthomas" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://about.me/j_thomas">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Capturing Runtime Metrics for OpenWhisk Applications</h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-12-18T09:21:00+00:00" pubdate data-updated="true">Dec 18<span>th</span>, 2017</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>This blog post is part one of a series on &#8220;Monitoring Serverless Applications Metrics&#8221;. See the <a href="/blog/2017/12/15/serverless-applications-metrics-and-monitoring/">introduction post</a> for details and links to other posts.</em></p>

<p>Serverless platforms pose a unique challenge for collecting application metrics. Runtime environments are <a href="https://martinfowler.com/articles/serverless.html">ephemeral</a>, existing only to process requests.</p>

<p>Using a background process to capture and export metrics to an external service is impossible. With such a restricted runtime environment, we have to look at other options… 🤔</p>

<h2>exporting serverless runtime metrics</h2>

<h3>console logs with alarm trigger</h3>

<p>Apache OpenWhisk captures console logs written to stdout or stderr by actions. Logs are available in <a href="https://github.com/apache/incubator-openwhisk/blob/master/docs/reference.md#activation-record">activation records</a> through the <a href="http://petstore.swagger.io/?url=https://raw.githubusercontent.com/openwhisk/openwhisk/master/core/controller/src/main/resources/apiv1swagger.json">platform API</a>.</p>

<p>Runtime metrics written to the console will be saved in the activation records.</p>

<p>An additional action, triggered from the <a href="https://github.com/apache/incubator-openwhisk-package-alarms">alarm package</a>, can be scheduled to collect these values from the logs and forward to the metrics service.</p>

<p><em>This approach is simple and does not interfere with request processing. However, it does add a delay to the metric values being available in the collection service. This delay is dependent on the schedule chosen for the alarm trigger feed.</em></p>

<h3>send before returning</h3>

<p>Another option is to instrument the serverless functions to automatically collect and push metrics to the metric service before returning from the function.</p>

<p>The function will have to wait for the external metrics service to respond before returning.</p>

<p><em>This method pushes metric values into the collection service in real-time. There is no waiting for the background collection action to run. The disadvantage of this approach is that it adds a delay to each request. This delay is dependent on the response time from the collection service.</em></p>

<h2>capturing runtime metrics</h2>

<p>Metric values will have to be captured using a runtime library, due to the restrictions on running background processes.</p>

<p>The library should automatically capture registered metrics during each invocation. Values will be forwarded to the collection service using the configured forwarding method.</p>

<h3>openwhisk-metrics</h3>

<p>There is a Node.js library to ease the process of capturing runtime metrics for OpenWhisk actions.</p>

<p><a href="https://github.com/jthomas/openwhisk-metrics">https://github.com/jthomas/openwhisk-metrics</a></p>

<p>Node.js actions are wrapped with a proxy to automate recording metrics during invocations.</p>

<p>Metric values for <code>cpu</code>, <code>memory</code>, <code>time</code>, <code>error</code> and <code>coldstart</code> are collected by default. It supports adding custom metric collectors.</p>

<h4>usage</h4>

<p>Wrap action handlers with the metrics library.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">metrics</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;openwhisk-metrics&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">params</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;Hello World&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">main</span> <span class="o">=</span> <span class="nx">metrics</span><span class="p">(</span><span class="nx">main</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Metrics values are logged to stdout for each invocation of the serverless function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">rss</span> <span class="mi">53018624</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">heapTotal</span> <span class="mi">34463744</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">heapUsed</span> <span class="mi">16955224</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">external</span> <span class="mi">987361</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">error</span> <span class="mi">0</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">coldstart</span> <span class="mi">0</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">cpu</span><span class="p">.</span><span class="nx">user</span> <span class="mi">177</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">cpu</span><span class="p">.</span><span class="nx">system</span> <span class="mi">2</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">start</span> <span class="mi">1511605588388</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">end</span> <span class="mi">1511605588468</span> <span class="mi">1512489781</span>
</span><span class='line'><span class="nx">METRIC</span> <span class="o">&lt;</span><span class="nx">workspace</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">action_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">activation</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">duration</span> <span class="mi">80</span> <span class="mi">1512489781</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you are collecting metrics, you need a monitoring service to forward them to…</p>

<h2>monitoring service</h2>

<p>We&#8217;re going to look at collecting and visualising metrics using the <a href="https://console.bluemix.net/docs/services/cloud-monitoring/monitoring_ov.html#monitoring_ov">IBM Cloud Monitoring Service</a>.</p>

<blockquote><p>Use the IBM® Cloud Monitoring service to expand your collection and retention capabilities when working with metrics, and to be able to define rules and alerts that notify you of conditions that require attention.</p></blockquote>

<p><a href="https://console.bluemix.net/docs/services/cloud-monitoring/monitoring_ov.html#monitoring_ov">IBM Cloud Monitoring service</a> comes with a metric collection service, Grafana-based visualisation dashboard and an alerting system.</p>

<p>Let&#8217;s demonstrate how to use the approaches listed above for exporting metrics to the IBM Cloud Monitoring service.</p>

<p>There&#8217;s an <a href="https://github.com/jthomas/cloud-functions-metrics-service">additional Node.js library</a> to integrate the <a href="https://github.com/jthomas/openwhisk-metrics">OpenWhisk Metrics</a> library with the IBM Cloud Monitoring Service. This can forward metrics in real-time or batches (using a schedule action from a timer).</p>

<h3>provisioning</h3>

<p>An instance of the service must be provisioned before being used.</p>

<p><em>The service is available in <a href="https://console.bluemix.net/docs/services/cloud-monitoring/monitoring_ov.html#monitoring_ov">multiple regions</a>. Choose the same region as the IBM Cloud Functions instance for best performance.</em></p>

<p>Instances can be provisioned through the <a href="https://console.bluemix.net">IBM Cloud dashboard</a> or the <a href="https://console.bluemix.net/docs/cli/reference/bluemix_cli/get_started.html#getting-started">IBM Cloud CLI</a> tool.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'> <span class="nx">$</span> <span class="nx">bx</span> <span class="nx">cf</span> <span class="nx">create</span><span class="o">-</span><span class="nx">service</span> <span class="nx">Monitoring</span> <span class="nx">lite</span> <span class="nx">my_monitoring_svc</span>
</span></code></pre></td></tr></table></div></figure>


<p>For more details on provisioning instances of this service, please see the documentation: <a href="https://console.bluemix.net/docs/services/cloud-monitoring/how-to/provision.html#provision">https://console.bluemix.net/docs/services/cloud-monitoring/how-to/provision.html#provision</a></p>

<h3>authentication</h3>

<p>IBM Cloud Monitoring supports the following authentication methods: <em>API Key, UAA Token or IAM Token.</em></p>

<p>An API key will be used to provide authentication credentials in the examples below.</p>

<p>Keys can be created through the <a href="https://console.bluemix.net">IBM Cloud dashboard</a> or the <a href="https://console.bluemix.net/docs/cli/reference/bluemix_cli/get_started.html#getting-started">IBM Cloud CLI</a> tool.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">bx</span> <span class="nx">iam</span> <span class="nx">api</span><span class="o">-</span><span class="nx">key</span><span class="o">-</span><span class="nx">create</span> <span class="nx">metrics</span><span class="o">-</span><span class="nx">key</span> <span class="o">-</span><span class="nx">d</span> <span class="s2">&quot;API Key For Serverless Metrics&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Note:</strong> <em>The API key is only shown at the time of creation. If the API key is lost, you must create a new API key.</em></p>

<p>For more details on creating API keys, please see the documentation here: <a href="https://console.bluemix.net/docs/services/cloud-monitoring/security/auth_api_key.html#auth_api_key">https://console.bluemix.net/docs/services/cloud-monitoring/security/auth_api_key.html#auth_api_key</a></p>

<h3>space domain</h3>

<p>The GUID of the <a href="https://console.bluemix.net/docs/admin/orgs_spaces.html#orgsspacesusers">account space</a> is also required to use the metrics service.</p>

<p>Retrieve this value using the IBM Cloud CLI tool. Replace <code>SpaceName</code> with the name of the space.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">bx</span> <span class="nx">iam</span> <span class="nx">space</span> <span class="nx">SpaceName</span> <span class="o">--</span><span class="nx">guid</span>
</span></code></pre></td></tr></table></div></figure>


<p>The GUID for the space is returned.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">bx</span> <span class="nx">iam</span> <span class="nx">space</span> <span class="nx">dev</span> <span class="o">--</span><span class="nx">guid</span>
</span><span class='line'><span class="mi">667</span><span class="nx">fadfc</span><span class="o">-</span><span class="nx">jhtg</span><span class="o">-</span><span class="mi">1234</span><span class="o">-</span><span class="mi">9</span><span class="nx">f0e</span><span class="o">-</span><span class="nx">cf4123451095</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Note:</strong> <em>Space GUIDs must be prefixed with <code>s-</code> when being using with the monitoring service.</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s2">&quot;667fadfc-jhtg-1234-9f0e-cf4123451095&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;s-667fadfc-jhtg-1234-9f0e-cf4123451095&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>example (real-time forwarding)</h2>

<p>Let&#8217;s start with an example of using real-time forwarding of metrics values. Metric values will be automatically collected by the runtime library. Before each invocation finishes, the library will send the values to the external collection service.</p>

<p><em>This example assumes you already have the CLI tool for IBM Cloud Functions installed and configured. If you need to do this, please follow the instructions <a href="https://console.bluemix.net/openwhisk/learn/cli">here</a>.</em></p>

<h3>create new directory</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">mkdir</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">cd</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span>
</span></code></pre></td></tr></table></div></figure>


<h3>initialise npm package</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">init</span> <span class="o">-</span><span class="nx">y</span>
</span></code></pre></td></tr></table></div></figure>


<h3>install libraries</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">install</span> <span class="nx">openwhisk</span><span class="o">-</span><span class="nx">metrics</span> <span class="nx">cloud</span><span class="o">-</span><span class="nx">functions</span><span class="o">-</span><span class="nx">metrics</span><span class="o">-</span><span class="nx">service</span>
</span></code></pre></td></tr></table></div></figure>


<h3>update action handler source</h3>

<p>Create a file called <code>index.js</code> with following code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">metrics</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;openwhisk-metrics&#39;</span><span class="p">)</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">service</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cloud-functions-metrics-service&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nx">metrics</span><span class="p">.</span><span class="nx">service</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">client</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;metrics.&lt;???&gt;.bluemix.net&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">scope</span><span class="o">:</span> <span class="s1">&#39;s-&lt;???&gt;&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">api_key</span><span class="o">:</span> <span class="s1">&#39;&lt;???&gt;&#39;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">params</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;Hello World&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">main</span> <span class="o">=</span> <span class="nx">metrics</span><span class="p">(</span><span class="nx">main</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Replace the <code>host</code>, <code>scope</code> and <code>api_key</code> parameters custom values. Host names for the regional monitoring service endpoints are listed <a href="https://console.bluemix.net/docs/services/cloud-monitoring/send_retrieve_metrics_ov.html#endpoints">here</a>.</p>

<p><em>Space GUIDs must be prefixed with <code>s-</code> to identify a space in the <code>scope</code> parameter.</em></p>

<h3>create new action</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">zip</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">action</span><span class="p">.</span><span class="nx">zip</span> <span class="nx">index</span><span class="p">.</span><span class="nx">js</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span> <span class="nx">node_modules</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">action</span> <span class="nx">create</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span> <span class="o">--</span><span class="nx">kind</span> <span class="nx">nodejs</span><span class="o">:</span><span class="mi">8</span> <span class="nx">action</span><span class="p">.</span><span class="nx">zip</span>
</span></code></pre></td></tr></table></div></figure>


<h3>invoke action</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">action</span> <span class="nx">invoke</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span> <span class="o">-</span><span class="nx">b</span>
</span><span class='line'><span class="nx">ok</span><span class="o">:</span> <span class="nx">invoked</span> <span class="o">/</span><span class="nx">_</span><span class="o">/</span><span class="nx">hello</span><span class="o">-</span><span class="nx">world</span> <span class="kd">with</span> <span class="nx">id</span> <span class="mi">74</span><span class="nx">add543b3b94bbbadd543b3b9dbbb17</span>
</span></code></pre></td></tr></table></div></figure>


<h3>use api to list metrics</h3>

<p>Use <code>curl</code> to manually list the ingested metric labels for IBM Cloud Functions.</p>

<p><strong>Replace the <code>&lt;???&gt;</code> values in the command with configuration values from above.</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">curl</span> <span class="o">--</span><span class="nx">url</span> <span class="s1">&#39;https://metrics.&lt;???&gt;.bluemix.net/v1/metrics/list?query=ibm.public.cloud-functions.*.*.*.*&#39;</span> <span class="o">--</span><span class="nx">header</span> <span class="s1">&#39;x-auth-scope-id: s-&lt;???&gt;&#39;</span> <span class="o">--</span><span class="nx">header</span> <span class="s1">&#39;X-Auth-User-Token: apikey &lt;???&gt;&#39;</span>
</span><span class='line'><span class="p">[{</span>
</span><span class='line'>  <span class="s2">&quot;leaf&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;context&quot;</span><span class="o">:</span> <span class="p">{},</span>
</span><span class='line'>  <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;72df4bc809c04fae9f4bc809c01fae77&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;expandable&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;ibm.public.cloud-functions.*.*.*.72df4bc809c04fae9f4bc809c01fae77&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;allowChildren&quot;</span><span class="o">:</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Each activation identifier should be listed as a label value in the metrics service.</p>

<h2>example (batch forwarding)</h2>

<p>If we don&#8217;t want to add a (short) delay to each invocation, metric values can be forwarded asynchronously. An explicit action will be created to forward metric values from invocation logs. This action will be triggered on a periodic schedule using the alarm trigger feed.</p>

<p><em>This example assumes you already have the CLI tool for IBM Cloud Functions installed and configured. If you need to do this, please follow the instructions <a href="https://console.bluemix.net/openwhisk/learn/cli">here</a>.</em></p>

<h3>create sample action</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">mkdir</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">cd</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">init</span> <span class="o">-</span><span class="nx">y</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">install</span> <span class="nx">openwhisk</span><span class="o">-</span><span class="nx">metrics</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a file called <code>index.js</code> with the following code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">metrics</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;openwhisk-metrics&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">params</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;Hello World&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">main</span> <span class="o">=</span> <span class="nx">metrics</span><span class="p">(</span><span class="nx">main</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>deploy and test sample action</h3>

<p>Package and deploy <code>hello-world</code> action.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">zip</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">action</span><span class="p">.</span><span class="nx">zip</span> <span class="nx">index</span><span class="p">.</span><span class="nx">js</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span> <span class="nx">node_modules</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">action</span> <span class="nx">create</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span> <span class="o">--</span><span class="nx">kind</span> <span class="nx">nodejs</span><span class="o">:</span><span class="mi">8</span> <span class="nx">action</span><span class="p">.</span><span class="nx">zip</span>
</span></code></pre></td></tr></table></div></figure>


<p>Metric values are written to the console for each invocation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">action</span> <span class="nx">invoke</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span> <span class="o">-</span><span class="nx">b</span>
</span><span class='line'><span class="nx">ok</span><span class="o">:</span> <span class="nx">invoked</span> <span class="o">/</span><span class="nx">_</span><span class="o">/</span><span class="nx">hello</span><span class="o">-</span><span class="nx">world</span> <span class="kd">with</span> <span class="nx">id</span> <span class="mi">28</span><span class="nx">da39d219df436a9a39d219df036a30</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">activation</span> <span class="nx">logs</span> <span class="mi">28</span><span class="nx">da39d219df436a9a39d219df036a30</span>
</span><span class='line'><span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="nx">T14</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">50.751615113</span><span class="nx">Z</span> <span class="nx">stdout</span><span class="o">:</span> <span class="nx">METRIC</span> <span class="nx">user</span><span class="err">@</span><span class="nx">host_dev</span><span class="p">.</span><span class="nx">hello</span><span class="o">-</span><span class="nx">world</span><span class="p">.</span><span class="mi">28</span><span class="nx">da39d219df436a9a39d219df036a30</span><span class="p">.</span><span class="nx">cpu</span><span class="p">.</span><span class="nx">user</span> <span class="mi">0</span> <span class="mi">1513607930</span>
</span><span class='line'><span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="nx">T14</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">50.751672372</span><span class="nx">Z</span> <span class="nx">stdout</span><span class="o">:</span> <span class="nx">METRIC</span> <span class="nx">user</span><span class="err">@</span><span class="nx">host_dev</span><span class="p">.</span><span class="nx">hello</span><span class="o">-</span><span class="nx">world</span><span class="p">.</span><span class="mi">28</span><span class="nx">da39d219df436a9a39d219df036a30</span><span class="p">.</span><span class="nx">cpu</span><span class="p">.</span><span class="nx">system</span> <span class="mi">0</span> <span class="mi">1513607930</span>
</span><span class='line'><span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span><span class="nx">T14</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">50.751685034</span><span class="nx">Z</span> <span class="nx">stdout</span><span class="o">:</span> <span class="nx">METRIC</span> <span class="nx">user</span><span class="err">@</span><span class="nx">host_dev</span><span class="p">.</span><span class="nx">hello</span><span class="o">-</span><span class="nx">world</span><span class="p">.</span><span class="mi">28</span><span class="nx">da39d219df436a9a39d219df036a30</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">start</span> <span class="mi">1513607930749</span> <span class="mi">1513607930</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<h3>create metric-forwarder action</h3>

<p>Clone the project repository and install NPM dependencies.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/jthomas/cloud-functions-metrics-service</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">cd</span> <span class="nx">cloud</span><span class="o">-</span><span class="nx">functions</span><span class="o">-</span><span class="nx">metrics</span><span class="o">-</span><span class="nx">service</span>
</span><span class='line'><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>Update action configuration file (<code>config.json</code>) with the following parameter values.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;actions&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;hello-world&quot;</span><span class="p">],</span>
</span><span class='line'>  <span class="s2">&quot;service&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;host&quot;</span><span class="o">:</span> <span class="s2">&quot;metrics.&lt;???&gt;.bluemix.net&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;scope&quot;</span><span class="o">:</span> <span class="s2">&quot;s-&lt;???&gt;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;api_key&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;???&gt;&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Replace the <code>&lt;???&gt;</code> fields in the configuration file from values from above.</strong></p>

<p>Package <code>metric-forwarder</code> action.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">zip</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">action</span><span class="p">.</span><span class="nx">zip</span> <span class="nx">index</span><span class="p">.</span><span class="nx">js</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span> <span class="nx">lib</span> <span class="nx">node_modules</span>
</span></code></pre></td></tr></table></div></figure>


<h3>deploy metric-forwarder action</h3>

<p>Create new <code>metric-forwarder</code> action from deployment package and configuration file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">action</span> <span class="nx">create</span> <span class="nx">metric</span><span class="o">-</span><span class="nx">forwarder</span> <span class="o">--</span><span class="nx">kind</span> <span class="nx">nodejs</span><span class="o">:</span><span class="mi">8</span> <span class="nx">action</span><span class="p">.</span><span class="nx">zip</span> <span class="o">--</span><span class="nx">param</span><span class="o">-</span><span class="nx">file</span> <span class="nx">config</span><span class="p">.</span><span class="nx">json</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create trigger feed for alarm package to run <code>metric-forwarder</code> on periodic schedule.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">trigger</span> <span class="nx">create</span> <span class="nx">interval</span> <span class="o">\</span>
</span><span class='line'>  <span class="o">--</span><span class="nx">feed</span> <span class="o">/</span><span class="nx">whisk</span><span class="p">.</span><span class="nx">system</span><span class="o">/</span><span class="nx">alarms</span><span class="o">/</span><span class="nx">interval</span> <span class="o">\</span>
</span><span class='line'>  <span class="o">--</span><span class="nx">param</span> <span class="nx">minutes</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bind trigger to action using rule.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">rule</span> <span class="nx">create</span> <span class="nx">forward</span><span class="o">-</span><span class="nx">metrics</span><span class="o">-</span><span class="nx">on</span><span class="o">-</span><span class="nx">interval</span> <span class="nx">interval</span> <span class="nx">metric</span><span class="o">-</span><span class="nx">forwarder</span>
</span></code></pre></td></tr></table></div></figure>


<h3>invoke sample action</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">action</span> <span class="nx">invoke</span> <span class="nx">hello</span><span class="o">-</span><span class="nx">world</span> <span class="o">-</span><span class="nx">b</span>
</span><span class='line'><span class="nx">ok</span><span class="o">:</span> <span class="nx">invoked</span> <span class="o">/</span><span class="nx">_</span><span class="o">/</span><span class="nx">hello</span><span class="o">-</span><span class="nx">world</span> <span class="kd">with</span> <span class="nx">id</span> <span class="mi">28</span><span class="nx">da39d219df436a9a39d219df036a30</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will generate activation records containing metric values. When the <code>interval</code> trigger is next fired, metric values from these records forwarded to the collection service.</p>

<p>Logs from the <code>metric-forwarder</code> action will show the activation records that have been retrieved.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">wsk</span> <span class="nx">activation</span> <span class="nx">poll</span> <span class="nx">metric</span><span class="o">-</span><span class="nx">forwarder</span>
</span></code></pre></td></tr></table></div></figure>


<h3>use api to list metrics</h3>

<p>Use <code>curl</code> to manually list the ingested metric labels for IBM Cloud Functions.</p>

<p><strong>Replace the <code>&lt;???&gt;</code> values in the command with configuration values from above.</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">curl</span> <span class="o">--</span><span class="nx">url</span> <span class="s1">&#39;https://metrics.&lt;???&gt;.bluemix.net/v1/metrics/list?query=ibm.public.cloud-functions.*.*.*.*&#39;</span> <span class="o">--</span><span class="nx">header</span> <span class="s1">&#39;x-auth-scope-id: s-&lt;???&gt;&#39;</span> <span class="o">--</span><span class="nx">header</span> <span class="s1">&#39;x-auth-user-token: apikey &lt;???&gt;&#39;</span>
</span><span class='line'><span class="p">[{</span>
</span><span class='line'>  <span class="s2">&quot;leaf&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;context&quot;</span><span class="o">:</span> <span class="p">{},</span>
</span><span class='line'>  <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;72df4bc809c04fae9f4bc809c01fae77&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;expandable&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;ibm.public.cloud-functions.*.*.*.28da39d219df436a9a39d219df036a30&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;allowChildren&quot;</span><span class="o">:</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Each activation identifier should be listed as a label value in the metrics service.</p>

<h2>next steps</h2>

<p>Metric values from our serverless applications are now being collected by the IBM Cloud Monitoring service. 👏👏👏</p>

<p>Applications metrics are automatically recorded by the runtime library for each invocation. Metric values are exported to the monitoring service in real-time or using a timed action to forward in batches.</p>

<p>Setting up monitoring dashboards from the collected values will allow us to identify and resolve issues with our serverless applications. In the next blog post, we&#8217;ll look using Grafana to visualise metric values being collected…</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">James Thomas</span></span>

      








  


<time datetime="2017-12-18T09:21:00+00:00" pubdate data-updated="true">Dec 18<span>th</span>, 2017</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/metrics/'>metrics</a>, <a class='category' href='/blog/categories/openwhisk/'>openwhisk</a>, <a class='category' href='/blog/categories/serverless/'>serverless</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jthomas.github.com/jthomas/blog/2017/12/18/capturing-runtime-metrics-for-openwhisk-applications/" data-via="thomasj" data-counturl="http://jthomas.github.com/jthomas/blog/2017/12/18/capturing-runtime-metrics-for-openwhisk-applications/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2017/12/15/serverless-applications-metrics-and-monitoring/" title="Previous Post: Monitoring Serverless Applications Metrics">&laquo; Monitoring Serverless Applications Metrics</a>
      
      
        <a class="basic-alignment right" href="/blog/2018/01/05/visualising-metrics-with-grafana-dashboards/" title="Next Post: Visualising Serverless Metrics With Grafana Dashboards">Visualising Serverless Metrics With Grafana Dashboards &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/01/05/visualising-metrics-with-grafana-dashboards/">Visualising Serverless Metrics With Grafana Dashboards</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/12/18/capturing-runtime-metrics-for-openwhisk-applications/">Capturing Runtime Metrics For OpenWhisk Applications</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/12/15/serverless-applications-metrics-and-monitoring/">Monitoring Serverless Applications Metrics</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/11/21/openwhisk-logstash-forwarder/">Openwhisk Logstash Forwarder</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/31/openwhisk-alarm-trigger-schedules/">advanced openwhisk alarm schedules</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("thomasj", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/thomasj" class="twitter-follow-button" data-show-count="false">Follow @thomasj</a>
  
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:jamesthomas">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "jamesthomas"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - James Thomas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'notesonjavascript';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jthomas.github.com/jthomas/blog/2017/12/18/capturing-runtime-metrics-for-openwhisk-applications/';
        var disqus_url = 'http://jthomas.github.com/jthomas/blog/2017/12/18/capturing-runtime-metrics-for-openwhisk-applications/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
