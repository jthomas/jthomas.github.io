<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.69.2" />

    
    
    

<title>Phonebot â€¢ notes on software.</title>
<meta name="description" content="James Thomas&#39; blog about software. Posts about serverless, cloud platforms, openwhisk, node.js and more...">
<meta name="keywords" content="blog,serverless,openwhisk,ibm,nodejs,tensorflow,serverless framework,open-source,conferences,developer advocacy,github">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Phonebot"/>
<meta name="twitter:description" content="Last month, a colleague was explaining he was not looking forward to an afternoon of long-distance conference calls. Having recently started using Slack for collaboration with their remote team, they lamented&hellip;
 I wish I could do my conference calls using Slack!
 &hellip;which got us thinking.
Recent experiments with IBM Watson Speech To Text and Twilio on IBM Bluemix had shown how easy it was to create telephony applications. Slack publishes multiple APIs to help developers build custom &ldquo;bots&rdquo; that respond to channel content."/>

<meta property="og:title" content="Phonebot" />
<meta property="og:description" content="Last month, a colleague was explaining he was not looking forward to an afternoon of long-distance conference calls. Having recently started using Slack for collaboration with their remote team, they lamented&hellip;
 I wish I could do my conference calls using Slack!
 &hellip;which got us thinking.
Recent experiments with IBM Watson Speech To Text and Twilio on IBM Bluemix had shown how easy it was to create telephony applications. Slack publishes multiple APIs to help developers build custom &ldquo;bots&rdquo; that respond to channel content." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jamesthom.as/2015/05/phonebot/" />
<meta property="article:published_time" content="2015-05-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2015-05-29T00:00:00+00:00" />


    






<link rel="stylesheet" href="/scss/hyde-hyde.3081c4981fb69a2783dd36ecfdd0e6ba7a158d4cbfdd290ebce8f78ba0469fc6.css" integrity="sha256-MIHEmB&#43;2mieD3Tbs/dDmunoVjUy/3SkOvOj3i6BGn8Y=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    <style type="text/css">
.content {
  max-width: 48rem;
}

.sidebar .container {
  padding-right: 0rem;
  padding-left: 0rem;
}

h1 {
  margin-top: 0;
}
</style>

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://jamesthom.as/">notes on software.</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://jamesthom.as/profile.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         by james thomas serverless aficionado. 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">notes on software.</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/thomasj" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/jthomas" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	<a href="https://stackoverflow.com/users/1427084" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://medium.com/@jamesthom.as" rel="me"><i class="fab fa-medium fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
        
	<a href="https://www.youtube.com/user/jthomasuk" rel="me"><i class="fab fa-youtube fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="mailto:blog@jamesthom.as" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Phonebot</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> May 29, 2015
    
    
    
    
    
    <br/>
    
    <i class="fas fa-clock"></i> 7 min read
    
</div>


  </header>
  
  
  <div class="post">
    <p><img src="/images/Phonebot.png" alt=""></p>
<p>Last month, a colleague was explaining he was not looking forward to an afternoon of long-distance conference
calls. Having recently started using Slack for collaboration with their remote team, they lamented&hellip;</p>
<blockquote>
<p>I wish I could do my conference calls using Slack!</p>
</blockquote>
<p>&hellip;which got us thinking.</p>
<p><a href="jamesthom.as/blog/2015/02/27/doctor-watson/">Recent experiments</a> with IBM Watson Speech To Text and Twilio on IBM Bluemix had shown how easy it was
to create telephony applications. Slack publishes multiple APIs to help developers build custom &ldquo;bots&rdquo; that respond to channel content.</p>
<p><strong>Could we create a new Slackbot that let users make phone calls using channel messages?</strong></p>
<p>One month later, <a href="https://github.com/IBM-Bluemix/phonebot">Phonebot</a> was born!</p>
<blockquote>
<p>Slackbot that lets users make phone calls within a Slack channel.
Users can dial a phone number, with the phone call audio converted to text and sent to the channel.
Channel message replies are converted to speech and sent over the phone call.</p>
</blockquote>
<p><strong>tl;dr</strong> Full source code for the project is available <a href="https://github.com/IBM-Bluemix/phonebot">here</a>.
Follow the <a href="https://github.com/IBM-Bluemix/phonebot#deployment-instructions">deployment instructions</a> to run your own version.</p>
<p>Read on to find out how we put IBM Watson, Twilio and IBM Bluemix to develop our custom Slackbot&hellip;</p>
<h2 id="custom-slackbots">Custom Slackbots</h2>
<p>Slack publishes <a href="https://api.slack.com/">numerous APIs</a> for integrating custom services. These APIs provide everything from
<a href="https://api.slack.com/slackbot">sending simple messages as Slackbot</a> to creating a <a href="https://api.slack.com/rtm">real-time messaging service</a>.</p>
<p>Phonebot will listen to messages starting with <em>@phonebot</em> and which contain user commands e.g. dial, hangup. It will create new
channel messages with the translated speech results along with status messages. Users can issue the following commands to control
Phonebot.</p>
<pre><code>@phonebot call PHONE_NUMBER &lt;-- Dials the phone number
@phonebot say TEXT &lt;-- Sends text as speech to the call 
@phonebot hangup &lt;-- Ends the active call
@phonebot verbose {on|off}&lt;-- Toggle verbose mode
@phonebot duration NUMBER &lt;-- Set recording duration
@phonebot help &lt;-- Show all commands usage information 
</code></pre><p>We use the <a href="https://api.slack.com/incoming-webhooks">Incoming Webhooks API</a> to
post new channel messages and the <a href="https://api.slack.com/outgoing-webhooks">Outgoing Webhook API</a>
to notify the application about custom channel commands.</p>
<h3 id="listening-for-custom-commands">Listening for custom commands</h3>
<p>Creating a new <a href="https://my.slack.com/services/new/outgoing-webhook">Outgoing Webhook</a>,
messages from the registered channels which begin with the &ldquo;@phonebot&rdquo; prefix
will be posted to HTTP URL for the IBM Bluemix application handling the incoming messages.</p>
<p>We can create Outgoing Webhooks for every channel we want to register Phonebot in.</p>
<p>For each registered channel, we need to allow Phonebot to post new messages.</p>
<p><img src="/images/outgoing_wh.png" alt=""></p>
<h3 id="sending-new-channel-messages">Sending new channel messages</h3>
<p><a href="https://my.slack.com/services/new/incoming-webhook">Incoming Webhooks</a> provide an obfuscated HTTP URL that allows unauthenticated HTTP requests to create new channel messages.
Creating a new Incoming obfuscated for each channel we are listening to will allow Phonebot to post responses.</p>
<p>Each Incoming Webhook URL will be passed to Phonebot application using configuration via environment variables.</p>
<p><img src="/images/incoming_wh.png" alt=""></p>
<h2 id="making-phone-calls">Making Phone Calls</h2>
<p><a href="https://www.twilio.com/">Twilio</a> provides &ldquo;telephony-as-a-service&rdquo;, allowing applications to make telephone calls using a REST API.</p>
<p>Twilio has been made available on the IBM Bluemix platform. Binding this service to your application will provide the authentication credentials to use with the Twilio <a href="http://twilio.github.io/twilio-node/">client library</a>.</p>
<p>When users issue the &ldquo;call&rdquo; command with a phone number, the channel bot listening to user commands emits a custom event.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">bot</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;call&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">number</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">phone</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">channels</span>[<span style="color:#a6e22e">channel</span>].<span style="color:#a6e22e">phone</span>
 
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">phone</span>.<span style="color:#a6e22e">call_active</span>()) {
    <span style="color:#a6e22e">bot</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;The line is busy, you have to hang up first...!&#39;</span>)
    <span style="color:#66d9ef">return</span>
  }
 
  <span style="color:#a6e22e">phone</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">number</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">base_url</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">channel</span>)
})
</code></pre></div><p>Within the &ldquo;phone&rdquo; object, the &ldquo;call&rdquo; method triggers the following code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">makeCall</span>({
  <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span>,
  <span style="color:#a6e22e">from</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">from</span>,
  <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">route</span>
}, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">responseData</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">err</span>) {
    <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">request_fail</span>(<span style="color:#e6db74">&#39;Failed To Start Call: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">number</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;(&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">route</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;) &#39;</span>, <span style="color:#a6e22e">err</span>)
    <span style="color:#66d9ef">return</span>
  }

  <span style="color:#a6e22e">that</span>.<span style="color:#a6e22e">request_success</span>(<span style="color:#e6db74">&#39;New Call Started: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">number</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; (&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">route</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;): &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">responseData</span>.<span style="color:#a6e22e">sid</span>, <span style="color:#a6e22e">responseData</span>)
})
</code></pre></div><p>The URL parameter provides a HTTP URL which Twilio will use to POST updated <a href="https://www.twilio.com/docs/api/twiml/twilio_request">call status information</a>.
HTTP responses from this location will tell Twilio how to handle the ongoing call, e.g. play an audio message, press the following digits, record phone line audio.</p>
<p>If the phone call connects successfully, we need the phone line audio stream to translate the speech into text.
<em>Unfortunately, Twilio does not support directly accessing the real-time audio stream. However, can record a batch
of audio, i.e five seconds, and download the resulting file.</em></p>
<p>Therefore, we will tell Twilio to record a short section of audio and post the results back to our application. When this message is received,
our response will contain the request to record another five seconds. This approach will provide a semi-realtime stream of phone call audio for processing.</p>
<p>Here is the code snippet to construct the TwiML response to record the audio snippet. Any channel messages that are queued for
sending as speech will be added to the outgoing response.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">twiml</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">twilio</span>.<span style="color:#a6e22e">TwimlResponse</span>()

<span style="color:#75715e">// Do we have text to send down the active call?
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">outgoing</span>.<span style="color:#a6e22e">length</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">user_speech</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">outgoing</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39; &#39;</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">outgoing</span> <span style="color:#f92672">=</span> []
    <span style="color:#a6e22e">twiml</span>.<span style="color:#a6e22e">say</span>(<span style="color:#a6e22e">user_speech</span>)
}

<span style="color:#a6e22e">twiml</span>.<span style="color:#a6e22e">record</span>({<span style="color:#a6e22e">playBeep</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">trim</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;do-not-trim&#39;</span>, <span style="color:#a6e22e">maxLength</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">defaults</span>.<span style="color:#a6e22e">duration</span>, <span style="color:#a6e22e">timeout</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">60</span>})
</code></pre></div><p>When we have the audio files containing the phone call audio, we can schedule these for translation with the IBM Watson Speech To Text service.</p>
<h2 id="translating-speech-to-text">Translating Speech To Text</h2>
<p>Using the <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/speech-to-text.html">IBM Watson Speech To Text</a>
service, we can simply transcribe phone calls by posting the audio file to the REST API. Using the <a href="">client library</a>
handles making the actual API requests behind a simple JavaScript interface.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">params</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">audio</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">createReadStream</span>(<span style="color:#a6e22e">file_name</span>),
  <span style="color:#a6e22e">content_type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;audio/l16; rate=16000&#39;</span>
}

<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">speech_to_text</span>.<span style="color:#a6e22e">recognize</span>(<span style="color:#a6e22e">params</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">res</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">err</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">err</span>)
    <span style="color:#66d9ef">return</span>
  }

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">results</span>[<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">result_index</span>]
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">result</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">transcript</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">alternatives</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">transcript</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;available&#39;</span>)
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Missing speech recognition result.&#39;</span>)
  }
})
</code></pre></div><p>Having <a href="http://jamesthom.as/blog/2015/02/27/doctor-watson/">previously</a> handling converting the audio
file from the format created by Twilio to that needed by the Watson API, we were able to reuse
the <a href="https://github.com/IBM-Bluemix/phonebot/blob/master/lib/translate.js">translate.js</a> class
between projects.</p>
<p>This module relies on the SOX library being installed in the native runtime. We used a
<a href="http://jamesthom.as/blog/2015/03/04/cloud-foundry-custom-buildpacks/">custom buildpack</a> to support this.</p>
<h3 id="managing-translation-tasks">Managing Translation Tasks</h3>
<p>When a new Twilio message with audio recording details is received, we schedule a translation request. As this background task returns, the results are
posted into the corresponding Slack channel.</p>
<p>If a translation request takes longer than expected, additional requests may be scheduled before the first has finished. We still want to maintain the order
when posting new channel messages, even if later requests finishing translating first.</p>
<p>Using the <a href="https://github.com/caolan/async">async</a> library, a single-worker <a href="https://github.com/caolan/async#queue">queue</a>
is created to schedule the translation tasks.</p>
<p>Each time the phone object for a channel emits a &lsquo;recording&rsquo; event, we start the translation
request and post the worker to the channel queue.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">phone</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;recording&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">location</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">phone</span>.<span style="color:#a6e22e">defaults</span>.<span style="color:#a6e22e">verbose</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">channels</span>[<span style="color:#a6e22e">channel</span>].<span style="color:#a6e22e">bot</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;:speech_balloon: _waiting for translation_&#39;</span>)
  }
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">req</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">translate</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">watson</span>, <span style="color:#a6e22e">location</span>)
  <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">start</span>()
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">channels</span>[<span style="color:#a6e22e">channel</span>].<span style="color:#a6e22e">queue</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">req</span>)
})
</code></pre></div><p>When a task reaches the front of the queue, the worker function is called to process the result.</p>
<p>If translation task has finished, we signal to the queue this task
has completed. Otherwise, we wait for completion events being emitted.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">queue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">async</span>.<span style="color:#a6e22e">queue</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">task</span>, <span style="color:#a6e22e">callback</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">done</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">message</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">message</span>) <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">channels</span>[<span style="color:#a6e22e">channel</span>].<span style="color:#a6e22e">bot</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;:speech_balloon: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">message</span>)
    <span style="color:#a6e22e">callback</span>()
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
  }

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">process</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">done</span>(<span style="color:#a6e22e">task</span>.<span style="color:#a6e22e">transcript</span>)
  }

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">failed</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">done</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">channels</span>[<span style="color:#a6e22e">channel</span>].<span style="color:#a6e22e">phone</span>.<span style="color:#a6e22e">defaults</span>.<span style="color:#a6e22e">verbose</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;_unable to recognise speech_&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>)
  }

  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">task</span>.<span style="color:#a6e22e">transcript</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">process</span>()) <span style="color:#66d9ef">return</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">task</span>.<span style="color:#a6e22e">failed</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">failed</span>()) <span style="color:#66d9ef">return</span>

  <span style="color:#a6e22e">task</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;available&#39;</span>, <span style="color:#a6e22e">process</span>)
  <span style="color:#a6e22e">task</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;failed&#39;</span>, <span style="color:#a6e22e">failed</span>)
}, <span style="color:#ae81ff">1</span>)
</code></pre></div><h2 id="deploying-phonebot">Deploying Phonebot</h2>
<p>Now we&rsquo;ve finished the code, we can configure the application to deploy on the IBM Bluemix cloud platform.</p>
<h3 id="configuring-webhooks">Configuring Webhooks</h3>
<p>Phonebot must be passed the configured incoming webhooks URLs, allowing it to send
channel messages. Following the <a href="http://12factor.net/config">standard Platform-as-a-Service convention</a> for passing configuration, we store the channel webhooks as environment variables.</p>
<p>Using the CF CLI, we run the following command to set up the local environment parameters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cf cups slack_webhooks -p <span style="color:#e6db74">&#39;{&#34;channel_name&#34;:&#34;incoming_webhook_url&#34;,...}&#39;</span>
</code></pre></div><h3 id="application-manifest">Application Manifest</h3>
<p>Application manifests configure deployment parameters for Cloud Foundry applications.
Phonebot will need to be bound to Twilio, IBM watson and custom services, along with configuring the runtime environment.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><em>&hellip;with this manifest, we can just use the <em>cf push</em> command to deploy our application!</em></p>
<h2 id="using-phonebot">Using Phonebot</h2>
<p>Phonebot will post the following message to each channel successfully registered on startup.</p>
<p><img src="/images/phonebot_is_here.png" alt=""></p>
<p>Users can issue <strong>@phonebot COMMAND</strong> messages to control phone calls directly from the slack channel.</p>
<p>For further information about the project, follow the <a href="https://github.com/IBM-Bluemix/phonebot">project on Github</a>.
Upcoming features are listed in the <a href="https://github.com/IBM-Bluemix/phonebot/issues">issues page</a>.
<strong>Please feel free to ask for new features, report bugs and leave feedback on Github.</strong></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/2015/04/ibm-watson-nodes-for-node-red/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">IBM Watson Nodes For Node-RED</span>
    </a>
    
    
    <a href="/2015/06/continuous-delivery-for-phonebot/" class="navigation-next">
      <span class="navigation-tittle">Continuous Delivery for Phonebot</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>
<script data-goatcounter="https://jamesthomas.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>


    
    
    <script type="text/javascript">
        

    </script>
    




    



    </body>
</html>
